// Bjax v1.0.1
!function(t){function e(t,a){void 0===a&&i(t)&&(a=t,t=void 0),t=$(t),this.options=r.extend({},e.defaults,a||{}),this.data={},void 0!==t&&this.loadElement(t),this.loadData(),this.loader=new e.Loader($(this.data.target)),this.execute()}if(!("jQuery"in t))return void console.error("Bjax's JavaScript requires jQuery.");var r=t.jQuery,a=function(t){return"[object Array]"===Object.prototype.toString.call(t)},i=function(t){return r.isPlainObject(t)},o=function(t){return a(t)?0===t.length:!t};e.VERSION="1.0.1",e.defaults={url_attribute:["data-href","href"],replace_attribute:"data-replace",replace:!0,element_attribute:"data-el",element:"html",target_attribute:"data-target",target:"html"},e.prototype.loadElement=function(t){var e={url:this.getValueByAttr(t,this.options.url_attribute),element:this.getValueByAttr(t,this.options.element_attribute),target:this.getValueByAttr(t,this.options.target_attribute),replace:this.getValueByAttr(t,this.options.replace_attribute)};for(var r in e)o(e[r])||(this.data[r]=e[r])},e.prototype.loadData=function(){var t={url:this.options.url,element:this.options.element,target:this.options.target,replace:this.options.replace};for(var e in t)o(t[e])||e in this.data||(this.data[e]=t[e])},e.prototype.getValueByAttr=function(t,e){a(e)||(e=[e]);for(var r=0;r<e.length;r++){var i=t.attr(e[r]);if("undefined"!=typeof i&&i!==!1)return i}return void 0},e.prototype.execute=function(){var t=this;t.loader.update(100,500),r.ajax({type:"GET",url:this.data.url,success:function(e){t.loader.update(100,300,function(){t.render(e),t.updateUrl(),document.title=$(e).filter("title").text()})},error:function(){t.loader.error(2e3,function(){t.execute()})}})},e.prototype.updateUrl=function(){if(this.data.replace===!0)try{t.history.pushState({path:t.location.href},"",this.data.url)}catch(e){console.error("history.pushState failed, maybe HTML5 is not supported?"),console.error(e.stack),t.location.replace(this.data.url)}},e.prototype.render=function(t){"html"!==this.data.element&&(t=$(t).find(this.data.element).html()),"html"!==this.data.target?$(this.data.target).html(t):(document.open(),document.write(t),document.close())},e.PercentLoader=function(t){this.target=t,this.backdrop=$('<div class="bjax-backdrop"></div>'),this.bar=$('<div class="bjax-bar"></div>'),this.err=$('<div class="bjax-backdrop-error"></div>'),this.abort=!1,this.init()},e.PercentLoader.prototype.init=function(){var t=this;this.target.css("position","relative"),this.backdrop.appendTo(this.target),this.bar.width(0),this.bar.appendTo(this.backdrop),this.err.appendTo(this.backdrop),$(document).on("click",".bjax-backdrop",function(){$(this).remove(),t.abort=!0,$(document).off("click",".bjax-backdrop")})},e.PercentLoader.prototype.update=function(t,e,r){this.bar.stop().animate({width:t+"%"},e,"linear",function(){void 0!==r&&r()})},e.PercentLoader.prototype.error=function(t,e){var r=this;this.bar.stop(),this.bar.width(0),this.bar.addClass("bjax-bar-error"),this.err.text("Error occurred, retrying. Click anywhere to exit."),this.bar.animate({width:"100%"},t,"linear",function(){r.bar.width(0),r.bar.removeClass("bjax-bar-error"),void 0!==e&&r.abort===!1&&e()})},e.Loader=e.PercentLoader,r.fn.bjax=function(t){return $(document).on("click",this.selector,function(r){new e(this,t),r.preventDefault()}),this},$(t).bind("popstate",function(t){var r=t.originalEvent.state;r&&new e({url:r.path,replace:!1})}),history.replaceState({path:t.location.href},""),t.Bjax=e}(window);
